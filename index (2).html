
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Windows 11 Upgrade Schedule</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f8f9fa;
      color: #333;
      padding: 40px;
    }
    h1 {
      color: #2c3e50;
      font-size: 28px;
    }
    p.instructions {
      font-size: 16px;
      color: #34495e;
      margin-bottom: 20px;
    }
    input[type="text"] {
      padding: 8px 10px;
      font-size: 14px;
      width: 300px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    th {
      background-color: #dbe9f4;
      color: #2c3e50;
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #ccc;
    }
    td {
      padding: 8px;
      border-bottom: 1px solid #eee;
    }
  </style>
</head>
<body>
  <h1>Windows 11 Upgrade Schedule</h1>
  <p class="instructions">
    Type your name or computer ID below to find your upgrade date. If you don’t see your device listed, it may already be upgraded or pending scheduling. Contact Tech Support if you have questions.
  </p>
  <input type="text" id="search" placeholder="Search by name or computer ID" oninput="renderTable()" autofocus>
  <div id="output">Loading...</div>

  <script>
    const SHEET_ID = "13c6BTkvAj8hyE7mQNCU7XNE5_MDkqEsGljyhy4EVGqg";
    const SHEET_GID = "0"; // Update if different tab
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?gid=${SHEET_GID}&tqx=out:json`;

    let rawData = [];

    fetch(SHEET_URL)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substring(47).slice(0, -2));
        const cols = json.table.cols.map(col => col.label);
        const rows = json.table.rows.map(row => row.c.map(c => (c ? c.v : 'Not Scheduled')));
        rawData = rows.map(r => Object.fromEntries(cols.map((col, i) => [col, r[i]])));
        renderTable();
      })
      .catch(err => {
        document.getElementById("output").innerHTML = "❌ Failed to load data.";
        console.error(err);
      });

    function renderTable() {
      const input = document.getElementById("search").value.toLowerCase();
      const filtered = rawData.filter(row =>
        Object.values(row).some(v => String(v).toLowerCase().includes(input))
      );

      if (filtered.length === 0) {
        document.getElementById("output").innerHTML = "<p>No matches found.</p>";
        return;
      }

      let html = "<table><tr>";
      const keys = Object.keys(filtered[0]).slice(0, 6);
      keys.forEach(key => html += `<th>${key}</th>`);
      html += "</tr>";

      filtered.forEach(row => {
        html += "<tr>";
        keys.forEach(key => html += `<td>${row[key]}</td>`);
        html += "</tr>";
      });

      html += "</table>";
      document.getElementById("output").innerHTML = html;
    }
  </script>
</body>
</html>
