<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Upgrade Schedule Lookup</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    input { margin-top: 10px; padding: 6px; width: 300px; }
    table { border-collapse: collapse; margin-top: 20px; width: 100%; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
  </style>
</head>
<body>
  <h2>Upgrade Schedule Lookup</h2>
  <input type="text" id="search" placeholder="Search by name or computer ID" oninput="renderTable()">
  <div id="output">Loading...</div>

  <script>
    const SHEET_ID = "13c6BTkvAj8hyE7mQNCU7XNE5_MDkqEsGljyhy4EVGqg";
    const SHEET_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;

    let rawData = [];

    fetch(SHEET_URL)
      .then(res => res.text())
      .then(text => {
        const json = JSON.parse(text.substring(47).slice(0, -2));
        const cols = json.table.cols.map(col => col.label);
        const rows = json.table.rows.map(row => row.c.map(c => (c ? c.v : '')));
        rawData = rows.map(r => Object.fromEntries(cols.map((col, i) => [col, r[i]])));
        renderTable();
      })
      .catch(err => {
        document.getElementById("output").innerHTML = "❌ Failed to load data.";
        console.error(err);
      });

    function renderTable() {
      const input = document.getElementById("search").value.toLowerCase();
      const filtered = rawData.filter(row =>
        Object.values(row).some(v => v.toString().toLowerCase().includes(input))
      );

      if (filtered.length === 0) {
        document.getElementById("output").innerHTML = "<p>No matches found.</p>";
        return;
      }

      let html = "<table><tr>";
      for (let key in filtered[0]) html += `<th>${key}</th>`;
      html += "</tr>";

      for (let row of filtered) {
        html += "<tr>";
        for (let key in row) html += `<td>${row[key]}</td>`;
        html += "</tr>";
      }

      html += "</table>";
      document.getElementById("output").innerHTML = html;
    }
  </script>
</body>
</html>
